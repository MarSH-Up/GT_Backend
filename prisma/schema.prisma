generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserAccessLevel {
  USER
  ADMIN
  STUDENT
  DOCTOR
  THERAPIST
}

model Institution {
  id        String   @id @default(uuid())
  name      String
  address   String?
  country   String?
  createdAt DateTime @default(now())

  users user[]
}

model user {
  id       String  @id @default(uuid())
  email    String  @unique
  name     String
  password String
  age      Int?
  gender   String? // 'male' | 'female' | 'non-binary' | 'prefer-not-to-say'
  phone    String?
  city     String?
  state    String?
  country  String?

  institutionId String? // Foreign key to Institution
  institution   Institution? @relation(fields: [institutionId], references: [id])

  userAccessLevel UserAccessLevel @default(USER)
  createdBy       String
  createdAt       DateTime        @default(now())
  deletedAt       DateTime?
  deletedBy       String?

  patientProfile      Patient?
  therapistId         String?
  sessionsAsTherapist Session[] @relation("ClinicianSessions")
}

model Patient {
  id          String  @id @default(uuid())
  userId      String  @unique
  laterality  String? // e.g. 'left', 'right'
  race        String? // optional, anonymized
  socialGroup String?
  therapyId   String?

  user     user      @relation(fields: [userId], references: [id])
  therapy  Therapy?  @relation(fields: [therapyId], references: [id])
  sessions Session[]
}

model Therapy {
  id       String    @id @default(uuid())
  name     String?
  patients Patient[]
}

model Session {
  id              String        @id @default(uuid())
  startTime       DateTime?
  endTime         DateTime?
  date            DateTime?
  patientId       String
  therapistId     String?
  sessionComments String?
  patient         Patient       @relation(fields: [patientId], references: [id])
  therapist       user?         @relation("ClinicianSessions", fields: [therapistId], references: [id])
  games           SessionGame[]
}

model SessionGame {
  id           String  @id @default(uuid())
  sessionId    String
  gameName     String
  playingTime  Int?
  score        Int?
  gameComments String?
  session      Session @relation(fields: [sessionId], references: [id])
}
